<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Buffer Class | Gridwise</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Buffer Class" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The Buffer class encapsulates data that spans both CPU (typed arrays) and GPU (GPUBuffer), providing a unified interface for data management." />
<meta property="og:description" content="The Buffer class encapsulates data that spans both CPU (typed arrays) and GPU (GPUBuffer), providing a unified interface for data management." />
<link rel="canonical" href="http://localhost:4000/gridwise/buffer/" />
<meta property="og:url" content="http://localhost:4000/gridwise/buffer/" />
<meta property="og:site_name" content="Gridwise" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Buffer Class" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"The Buffer class encapsulates data that spans both CPU (typed arrays) and GPU (GPUBuffer), providing a unified interface for data management.","headline":"Buffer Class","url":"http://localhost:4000/gridwise/buffer/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/gridwise/docs/assets/css/style.css">
    <script src="/gridwise/docs/assets/js/main.js" defer></script></head>
<body><header class="site-header" role="banner">
  <div class="wrapper">
    <div class="header-left">
      <a class="site-title" rel="author" href="/gridwise/">
        <span class="gradient-text">Gridwise Docs</span>
      </a>
    </div>

    <div class="header-right"><a class="header-link" href="/gridwise/examples-guide/">Examples</a>
      <a class="header-link" href="javascript:void(0)" onclick="launchExample()">Try Demo</a>
      <a class="github-button" href="https://github.com/gridwise-webgpu/gridwise" target="_blank" aria-label="GitHub">
        <svg viewBox="0 0 16 16" fill="currentColor">
          <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z" />
        </svg>
      </a>
    </div>
  </div>
</header>

<script>
  function launchExample() {
    window.open('https://gridwise-webgpu.github.io/gridwise/examples/scan_pane_example.html', '_blank');
  }
</script><div class="main-container">
  <!-- Modern Sidebar Navigation -->
  <aside class="docs-sidebar" id="docsSidebar">
    <div class="sidebar-content">
      <div class="sidebar-header">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
          <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
        </svg>
        <h1>Documentation</h1>
      </div>

      <div class="search-box">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.35-4.35"/>
        </svg>
        <input type="text" id="docsSearch" placeholder="Search docs..." />
      </div>

      <nav class="docs-nav"><div class="nav-section">
          <h3 class="nav-section-title">Getting Started</h3>
          <ul>
            <li>
              <a href="/gridwise/getting-started/" >
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                </svg>
                <span>Introduction</span>
              </a>
            </li>
            <li>
              <a href="/gridwise/installation/" >
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
                <span>Quick Start</span>
              </a>
            </li>
          </ul>
        </div><div class="nav-section">
          <h3 class="nav-section-title">Core Concepts</h3>
          <ul>
            <li>
              <a href="/gridwise/architecture/" >
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h4a1 1 0 011 1v7a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM14 5a1 1 0 011-1h4a1 1 0 011 1v7a1 1 0 01-1 1h-4a1 1 0 01-1-1V5zM4 16a1 1 0 011-1h4a1 1 0 011 1v3a1 1 0 01-1 1H5a1 1 0 01-1-1v-3zM14 16a1 1 0 011-1h4a1 1 0 011 1v3a1 1 0 01-1 1h-4a1 1 0 01-1-1v-3z" />
                </svg>
                <span>Architecture</span>
              </a>
            </li>
            <li>
              <a href="/gridwise/primitive-design/" >
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <span>Primitive Design</span>
              </a>
            </li>
            <li>
              <a href="/gridwise/subgroup-strategy/" >
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" />
                </svg>
                <span>Subgroup Strategy</span>
              </a>
            </li>
          </ul>
        </div><div class="nav-section">
          <h3 class="nav-section-title">Primitives</h3>
          <ul>
            <li>
              <a href="/gridwise/scan-and-reduce/" >
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
                <span>Scan and Reduce</span>
              </a>
            </li>
            <li>
              <a href="/gridwise/sort/" >
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                </svg>
                <span>Sort</span>
              </a>
            </li>
            <li>
              <a href="/gridwise/binop/" >
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <span>Binary Operations</span>
              </a>
            </li>
          </ul>
        </div><div class="nav-section">
          <h3 class="nav-section-title">Advanced</h3>
          <ul>
            <li>
              <a href="/gridwise/buffer/" class="active">
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4" />
                </svg>
                <span>Buffer Management</span>
              </a>
            </li>
            <li>
              <a href="/gridwise/timing-strategy/" >
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span>Timing Strategy</span>
              </a>
            </li>
            <li>
              <a href="/gridwise/webgpu-object-caching-strategy/" >
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h4a1 1 0 011 1v7a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM14 5a1 1 0 011-1h4a1 1 0 011 1v7a1 1 0 01-1 1h-4a1 1 0 01-1-1V5zM4 16a1 1 0 011-1h4a1 1 0 011 1v3a1 1 0 01-1 1H5a1 1 0 01-1-1v-3zM14 16a1 1 0 011-1h4a1 1 0 011 1v3a1 1 0 01-1 1h-4a1 1 0 01-1-1v-3z" />
                </svg>
                <span>Object Caching</span>
              </a>
            </li>
            <li>
              <a href="/gridwise/builtins-strategy/" >
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <span>Builtins Strategy</span>
              </a>
            </li>
          </ul>
        </div><div class="nav-section">
          <h3 class="nav-section-title">Examples</h3>
          <ul><li>
              <a href="/gridwise/examples/reduce/" >
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                </svg>
                <span>Reduce Example</span>
              </a>
            </li><li>
              <a href="/gridwise/examples/scan/" >
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                </svg>
                <span>Scan Example</span>
              </a>
            </li><li>
              <a href="/gridwise/examples/sort/" >
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                </svg>
                <span>Sort Example</span>
              </a>
            </li></ul>
        </div></nav>
    </div>

    <!-- Sidebar Footer -->
    <div class="sidebar-footer">
      <a href="https://github.com/gridwise-webgpu/gridwise" target="_blank" class="github-link">
        <svg class="github-icon" viewBox="0 0 16 16" fill="currentColor">
          <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z" />
        </svg>
        <span>GitHub</span>
      </a>
    </div>
  </aside>

  <!-- Main Content Area -->
  <main class="docs-content">
    <div class="content-inner"><div class="docs-hero">
        <div class="badge">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
          </svg>
          <span>Documentation</span>
        </div>
        <h1>Buffer Class</h1><p class="lead">The Buffer class encapsulates data that spans both CPU (typed arrays) and GPU (GPUBuffer), providing a unified interface for data management.</p></div><article class="post">
        <div class="post-content">
          <div style="max-width: 100%; padding: 0;">

<!-- Header Section -->
<header style="max-width: 100%; margin-bottom: 3rem;">
  <h1 style="font-size: 2.5rem; font-weight: 800; color: #111827; margin-bottom: 1.5rem; line-height: 1.2;">Buffer Class</h1>
  <p style="font-size: 1.25rem; color: #6b7280; line-height: 1.75;">
    During Gridwise's development, we found a need to encapsulate the concept of a single wad of data that spans CPU and GPU. The <code>Buffer</code> class contains both a CPU-side JS typed array and a GPU-side <code>GPUBuffer</code>, providing a unified interface for data management across both domains.
  </p>
</header>

<!-- Section 1: Purpose & Design Philosophy -->
<section style="max-width: 100%; margin-bottom: 4rem;">
  <h2 style="font-size: 1.5rem; font-weight: 700; color: #111827; margin-bottom: 1rem;">Design Philosophy</h2>
  <p style="color: #4b5563; line-height: 1.75; margin-bottom: 1rem;">
    The abstraction is that the CPU and GPU buffers are (roughly) consistent with each other—they are not meant to store two logically different objects. The <code>Buffer</code> class manages synchronization and lifecycle for both representations.
  </p>
  <p style="color: #4b5563; line-height: 1.75; margin-bottom: 1.5rem;">
    We believe this is an object whose design could be revisited and improved, because it is generally useful in WebGPU primitive development and more generally across WebGPU development. We welcome a redesign.
  </p>

  <div style="background: #f0fdf4; border-left: 4px solid #10b981; padding: 1.5rem;">
    <p style="margin: 0 0 0.75rem 0;"><strong style="color: #065f46;">Unified Interface:</strong> Single data structure that abstracts away the complexity of managing separate CPU and GPU buffers.</p>
    <p style="margin: 0;"><strong style="color: #065f46;">Automatic Sync:</strong> Handles data transfers between CPU and GPU with explicit control when needed.</p>
  </div>
</section>

<!-- Section 2: Use Cases -->
<section style="max-width: 100%; padding-top: 2rem; border-top: 1px solid #e5e7eb; margin-bottom: 3rem;">
  <h2 style="font-size: 1.875rem; font-weight: 700; color: #111827; margin-bottom: 2rem;">Use Cases</h2>
  
  <div style="background: #f0fdf4; border-left: 4px solid #10b981; padding: 1.5rem; margin-bottom: 1.5rem;">
    <p style="margin: 0 0 0.75rem 0;"><strong style="color: #065f46;">Unified Data Management:</strong> Couple CPU and GPU buffers that store the same logical data as one logical entity. The class can copy data between them easily.</p>
    <ul style="color: #065f46; margin: 0.5rem 0 0 1.5rem;">
      <li>CPU side: JavaScript typed array</li>
      <li>GPU side: WebGPU <code>GPUBuffer</code> (can be a subset of a GPU-side allocation)</li>
    </ul>
  </div>
  
  <p style="margin-bottom: 0.5rem;"><strong>Flexible Initialization:</strong> Initialize a <code>Buffer</code> in multiple ways—using an existing <code>GPUBuffer</code>, or asking the <code>Buffer</code> constructor to allocate one.</p>
  
  <p style="margin-bottom: 0.5rem;"><strong>Test Data Generation:</strong> Generate data on the CPU for testing, storing it in the CPU buffer. Support different methods for data generation (random numbers within a range, sequential data where <code>buffer[i] = i</code>, etc.).</p>
  
  <p style="margin-bottom: 0.5rem;"><strong>WebGPU Abstraction:</strong> Hide WebGPU details when possible (calls to create a <code>GPUBuffer</code>, transfers between CPU and GPU).</p>
  
  <p style="margin-bottom: 0.5rem;"><strong>Primitive Integration:</strong> The <code>Buffer</code> needs a label so it can be associated with Gridwise primitives.</p>
  
  <p style="margin-bottom: 0.5rem;"><strong>In-Place Operations:</strong> Some primitives (like sort) write their GPU output on top of their GPU input. A <code>Buffer</code> class must support this and additionally store the original (CPU) input for correctness validation.</p>
  
  <p style="margin-bottom: 1.5rem;"><strong>Size Queries:</strong> Query a <code>Buffer</code> for both <code>size</code> (number of bytes) and <code>length</code> (number of elements).</p>
</section>

<!-- Section 3: Constructor -->
<section style="padding-top: 2rem; border-top: 1px solid #e5e7eb; margin-bottom: 3rem;">
  <div style="max-width: 100%;">
    <h2 style="font-size: 1.875rem; font-weight: 700; color: #111827; margin-bottom: 1rem;">Constructor</h2>
    
    <div style="background: #1f2937; border-radius: 0.75rem; overflow: hidden; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); margin-bottom: 2rem;">
      <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1rem; background: #374151; border-bottom: 1px solid #4b5563;">
        <span style="font-family: 'Monaco', 'Menlo', monospace; font-size: 0.75rem; color: #9ca3af;">constructor(args)</span>
      </div>
      <div style="padding: 1.5rem;">
        <p style="color: #e5e7eb; font-size: 0.875rem; margin: 0;">
          Creates a new <code style="color: #fbbf24;">Buffer</code> instance, using the properties of the <code style="color: #fbbf24;">args</code> object to configure the buffer.
        </p>
      </div>
    </div>

    <h3 style="font-size: 1.25rem; font-weight: 700; color: #111827; margin-bottom: 1.5rem;">Arguments</h3>
    <p style="color: #4b5563; line-height: 1.75; margin-bottom: 1.5rem;">
      The constructor takes a single <code>args</code> object with these properties:
    </p>

    <div style="background: #f0fdf4; border-left: 4px solid #10b981; padding: 1.5rem; margin-bottom: 1.5rem;">
      <h4 style="font-size: 1.125rem; font-weight: 700; color: #065f46; margin-bottom: 1rem;">Required Properties</h4>
      
      <p style="margin-bottom: 0.5rem;"><code style="background: #dcfce7; color: #065f46; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-weight: 600;">device</code> (GPUDevice) – The WebGPU device used to create the buffer.</p>
      
      <p style="margin-bottom: 1rem;"><code style="background: #dcfce7; color: #065f46; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-weight: 600;">datatype</code> (string) – The data type of elements in the buffer (e.g., <code>'f32'</code>, <code>'u32'</code>, <code>'i32'</code>).</p>
      
      <h4 style="font-size: 1.125rem; font-weight: 700; color: #065f46; margin-bottom: 1rem; margin-top: 1rem;">Size Configuration <span style="font-size: 0.875rem; font-weight: 400;">(specify one)</span></h4>
      
      <p style="margin-bottom: 0.5rem;"><code style="background: #dcfce7; color: #065f46; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-weight: 600;">size</code> (number) – The buffer's total size in bytes. You must specify either <code>size</code> or <code>length</code>, but not both.</p>
      
      <p style="margin-bottom: 0;"><code style="background: #dcfce7; color: #065f46; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-weight: 600;">length</code> (number) – The number of elements in the buffer.</p>
    </div>
    
    <div style="background: #f0fdf4; border-left: 4px solid #10b981; padding: 1.5rem; margin-bottom: 1.5rem;">
      <h4 style="font-size: 1.125rem; font-weight: 700; color: #065f46; margin-bottom: 1rem;">Optional Properties</h4>
        
        <p style="margin-bottom: 0.5rem;"><code style="background: #dcfce7; color: #065f46; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-weight: 600;">label</code> (string) – A descriptive name for the buffer.</p>
        
        <p style="margin-bottom: 0.5rem;"><code style="background: #dcfce7; color: #065f46; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-weight: 600;">usage</code> (GPUBufferUsageFlags) – Specifies how the GPU buffer will be used. Defaults to <code>GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_SRC | GPUBufferUsage.COPY_DST</code>.</p>
        
        <p style="margin-bottom: 0.5rem;"><code style="background: #dcfce7; color: #065f46; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-weight: 600;">buffer</code> (GPUBuffer | GPUBufferBinding) – An existing buffer to wrap. If you provide this, <code>createGPUBuffer</code> should be <code>false</code>.</p>
        
        <p style="margin-bottom: 0.5rem;"><code style="background: #dcfce7; color: #065f46; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-weight: 600;">createCPUBuffer</code> (boolean) – If <code>true</code>, a CPU-side <code>TypedArray</code> is created.</p>
        
        <p style="margin-bottom: 0.5rem;"><code style="background: #dcfce7; color: #065f46; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-weight: 600;">initializeCPUBuffer</code> (string) – A keyword specifying how to fill the CPU buffer with initial data:</p>
        <ul style="margin: 0.5rem 0 0.5rem 1.5rem; line-height: 1.4;">
          <li>For floats (<code>'f32'</code>): <code>'randomizeMinusOneToOne'</code>, <code>'randomizeAbsUnder1024'</code>, <code>'fisher-yates'</code></li>
          <li>For integers (<code>'u32'</code>, <code>'i32'</code>, <code>'u64'</code>): <code>'xor-beef'</code>, <code>'randomizeAbsUnder1024'</code>, <code>'constant'</code>, <code>'bitreverse'</code>, <code>'randomBytes'</code>, <code>'fisher-yates'</code></li>
        </ul>
        
        <p style="margin-bottom: 0.5rem;"><code style="background: #dcfce7; color: #065f46; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-weight: 600;">storeCPUBackup</code> (boolean) – If <code>true</code>, a backup of the initialized CPU buffer is saved for later (useful if the primitive overwrites the buffer contents but we still need the original contents for validation).</p>
        
        <p style="margin-bottom: 0.5rem;"><code style="background: #dcfce7; color: #065f46; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-weight: 600;">createGPUBuffer</code> (boolean) – If <code>true</code>, the corresponding <code>GPUBuffer</code> is created on the GPU.</p>
        
        <p style="margin-bottom: 0.5rem;"><code style="background: #dcfce7; color: #065f46; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-weight: 600;">initializeGPUBuffer</code> (boolean) – If <code>true</code>, data from the CPU buffer is immediately copied to the GPU buffer. Requires <code>createCPUBuffer</code> to be <code>true</code>.</p>
        
        <p style="margin: 0;"><code style="background: #dcfce7; color: #065f46; padding: 0.125rem 0.5rem; border-radius: 0.25rem; font-weight: 600;">createMappableGPUBuffer</code> (boolean) – If <code>true</code>, a secondary, mappable GPU buffer is also created to help read data back from the GPU.</p>
      </div>
  </div>
</section>

<!-- Section 4: Methods -->
<section style="max-width: 100%; padding-top: 2rem; border-top: 1px solid #e5e7eb; margin-bottom: 3rem;">
  <h2 style="font-size: 1.875rem; font-weight: 700; color: #111827; margin-bottom: 2rem;">Methods</h2>
  
  <div style="background: #f0fdf4; border-left: 4px solid #10b981; padding: 1.5rem; margin-bottom: 1.5rem;">
    <h3 style="font-size: 1.125rem; font-weight: 700; color: #065f46; margin-bottom: 0.75rem;">
      <code>createCPUBuffer(args)</code>
    </h3>
    <p style="color: #065f46; margin: 0 0 0.5rem 0;">
      Creates and optionally initializes the CPU-side <code>TypedArray</code> buffer. You can call this after construction if the buffer wasn't created in the constructor.
    </p>
    <p style="color: #065f46; margin: 0;"><strong>Parameters:</strong> <code>args</code> (object) - An optional object to override the instance's <code>length</code> and <code>datatype</code> or provide initialization options.</p>
  </div>

  <p style="margin-bottom: 0.5rem;"><strong><code>createGPUBuffer(args)</code></strong> – Creates the <code>GPUBuffer</code> on the device. You can call this after construction if the GPU buffer wasn't created in the constructor.</p>
  <p style="margin-bottom: 1rem; padding-left: 1rem;">Parameters: <code>args</code> (object) - An optional object to override the instance's <code>device</code>, <code>size</code>, <code>datatype</code>, or <code>usage</code>.</p>

  <p style="margin-bottom: 0.5rem;"><strong><code>createMappableGPUBuffer(size)</code></strong> – Creates a separate GPU buffer that can be mapped by the CPU. This buffer is used as a temporary staging area for transferring data from the main GPU buffer back to the CPU.</p>
  <p style="margin-bottom: 1rem; padding-left: 1rem;">Parameters: <code>size</code> (number) - The size in bytes for the mappable buffer.</p>

  <p style="margin-bottom: 0.5rem;"><strong><code>copyCPUToGPU()</code></strong> – Uploads data from the CPU-side buffer (<code>cpuBuffer</code>) to the main GPU buffer.</p>

  <p style="margin-bottom: 0.5rem;"><strong><code>async copyGPUToCPU()</code></strong> – Asynchronously copies data from the GPU buffer back to the CPU-side buffer. It works by copying the data to a temporary mappable buffer, reading it back to the CPU, and updating the <code>cpuBuffer</code> property.</p>

  <p style="margin-bottom: 0.5rem;"><strong><code>copyCPUBackupToCPU()</code></strong> – Restores the <code>cpuBuffer</code> from the backup that was created during initialization.</p>

  <div style="padding: 1.5rem; border: 2px solid #ef4444; border-radius: 0.5rem; background: #fef2f2; margin-top: 1rem;">
    <p style="color: #991b1b; font-weight: 600; margin: 0;">
      <strong><code>destroy()</code></strong> – Destroys the associated GPU buffers to free up GPU memory.
    </p>
  </div>
</section>

<!-- Section 5: Properties -->
<section style="max-width: 100%; padding-top: 2rem; border-top: 1px solid #e5e7eb; margin-bottom: 3rem;">
  <h2 style="font-size: 1.875rem; font-weight: 700; color: #111827; margin-bottom: 2rem;">Properties (Getters &amp; Setters)</h2>
  
  <div style="background: #f0fdf4; border-left: 4px solid #10b981; padding: 1.5rem; margin-bottom: 1rem;">
    <p style="margin: 0 0 0.5rem 0;"><strong style="color: #065f46;"><code>buffer</code></strong></p>
    <p style="margin: 0 0 0.25rem 0;"><strong>get:</strong> Returns the GPU buffer as a <code>GPUBufferBinding</code> object (e.g., <code>{ buffer: GPUBuffer }</code>).</p>
    <p style="margin: 0;"><strong>set:</strong> Sets the internal GPU buffer. Accepts a raw <code>GPUBuffer</code> or a <code>GPUBufferBinding</code> object.</p>
  </div>

  <div style="background: #f0fdf4; border-left: 4px solid #10b981; padding: 1.5rem; margin-bottom: 1rem;">
    <p style="margin: 0 0 0.5rem 0;"><strong style="color: #065f46;"><code>cpuBuffer</code></strong></p>
    <p style="margin: 0;"><strong>get:</strong> Returns the CPU-side <code>TypedArray</code> (e.g., <code>Float32Array</code>, <code>Uint32Array</code>).</p>
  </div>

  <div style="background: #f0fdf4; border-left: 4px solid #10b981; padding: 1.5rem; margin-bottom: 1rem;">
    <p style="margin: 0 0 0.5rem 0;"><strong style="color: #065f46;"><code>cpuBufferBackup</code></strong></p>
    <p style="margin: 0;"><strong>get:</strong> Returns the backup <code>TypedArray</code> if one was created.</p>
  </div>

  <div style="background: #f0fdf4; border-left: 4px solid #10b981; padding: 1.5rem; margin-bottom: 1rem;">
    <p style="margin: 0 0 0.5rem 0;"><strong style="color: #065f46;"><code>size</code></strong></p>
    <p style="margin: 0;"><strong>get:</strong> Returns the size of the buffer in <strong>bytes</strong>.</p>
  </div>

  <div style="background: #f0fdf4; border-left: 4px solid #10b981; padding: 1.5rem; margin-bottom: 1rem;">
    <p style="margin: 0 0 0.5rem 0;"><strong style="color: #065f46;"><code>length</code></strong></p>
    <p style="margin: 0;"><strong>get:</strong> Returns the number of <strong>elements</strong> in the buffer.</p>
  </div>

  <div style="background: #f0fdf4; border-left: 4px solid #10b981; padding: 1.5rem;">
    <p style="margin: 0 0 0.5rem 0;"><strong style="color: #065f46;"><code>device</code></strong></p>
    <p style="margin: 0;"><strong>get:</strong> Returns the associated <code>GPUDevice</code>.</p>
  </div>
</section>

</div>

<style>
@media (max-width: 768px) {
  section[style*="grid-template-columns: 1fr 1fr"] {
    grid-template-columns: 1fr !important;
  }
  div[style*="position: sticky"] {
    position: relative !important;
  }
}
</style>


        </div>
      </article>
    </div>
  </main>
</div>

<script>
  // Save and restore sidebar scroll position
  (function() {
    const sidebar = document.querySelector('.docs-sidebar');
    if (!sidebar) return;
    
    // Restore scroll position immediately
    const savedScrollPos = sessionStorage.getItem('sidebarScrollPos');
    if (savedScrollPos) {
      sidebar.scrollTop = parseInt(savedScrollPos);
    }
    
    // Save on scroll
    let scrollTimer;
    sidebar.addEventListener('scroll', function() {
      clearTimeout(scrollTimer);
      scrollTimer = setTimeout(function() {
        sessionStorage.setItem('sidebarScrollPos', sidebar.scrollTop);
      }, 100);
    });
    
    // Save on link click and restore after navigation
    sidebar.querySelectorAll('a').forEach(function(link) {
      link.addEventListener('click', function(e) {
        sessionStorage.setItem('sidebarScrollPos', sidebar.scrollTop);
      });
    });
    
    // Restore again after a short delay to handle any reflows
    window.addEventListener('load', function() {
      if (savedScrollPos) {
        sidebar.scrollTop = parseInt(savedScrollPos);
      }
    });
  })();
</script>
<footer class="site-footer">
    <div class="wrapper">
        <p>&copy; 2026 Gridwise. WebGPU compute primitives in JavaScript</p><p><a href="mailto:jowens@ece.ucdavis.edu">jowens@ece.ucdavis.edu</a></p></div>
</footer></body>

</html>
